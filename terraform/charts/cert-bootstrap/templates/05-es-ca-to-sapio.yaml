{{- $src := lookup "v1" "Secret" "cert-manager" "es-root-ca" -}}
{{- if $src }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: es-ca
  namespace: {{ .Values.sapioNamespace | quote }}
  annotations:
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "50"
data:
  ca.crt: |
{{ index $src.data "tls.crt" | b64dec | nindent 4 }}
{{- else }}
{{- if and (not .Release.IsInstall) (.Values.failIfMissingCA | default false) }}
{{- fail "Secret cert-manager/es-root-ca not found" }}
{{- end }}
{{- end }}